<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎰 Slot Machine - YOMAN Data Dashboard</title>
    <meta name="description" content="Slot Machine Game Data Analysis Dashboard">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <span class="logo-icon">🎰</span>
                <span class="logo-text">SlotMachine - YOMAN<br><small>Data Dashboard</small></span>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-section="dashboard">
                    <span class="nav-icon">📊</span>
                    <span>儀表板</span>
                </a>
                <a href="#" class="nav-item" data-section="records">
                    <span class="nav-icon">📝</span>
                    <span>紀錄明細</span>
                </a>
                <a href="#" class="nav-item" data-section="export">
                    <span class="nav-icon">📥</span>
                    <span>匯出報表</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <div class="connection-status" id="connectionStatus">
                    <span class="status-dot"></span>
                    <span class="status-text">連線中...</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Mobile Menu Toggle -->
            <button class="menu-toggle" id="menuToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>

            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h1 class="page-title">儀表板</h1>
                    <p class="page-subtitle">即時監控老虎機遊戲數據</p>
                </div>
                <div class="header-right">
                    <div class="date-filter">
                        <button class="filter-btn active" data-range="today">今日</button>
                        <button class="filter-btn" data-range="week">本週</button>
                        <button class="filter-btn" data-range="month">本月</button>
                        <button class="filter-btn" data-range="all">全部</button>
                        <div class="custom-date-picker">
                            <input type="date" id="startDate" class="date-input">
                            <span class="date-separator">~</span>
                            <input type="date" id="endDate" class="date-input">
                            <button class="apply-btn" id="applyDateRange">套用</button>
                        </div>
                    </div>
                    <button class="refresh-btn" id="refreshBtn" title="重新整理">
                        <span class="refresh-icon">🔄</span>
                    </button>
                </div>
            </header>

            <!-- Stats Cards -->
            <section class="stats-grid stats-grid-2">
                <div class="stat-card gradient-purple">
                    <div class="stat-icon">🎮</div>
                    <div class="stat-content">
                        <span class="stat-value" id="totalPlays">--</span>
                        <span class="stat-label">總遊玩次數</span>
                    </div>
                    <div class="stat-trend" id="playsTrend"></div>
                </div>
                <div class="stat-card gradient-gold">
                    <div class="stat-icon">💰</div>
                    <div class="stat-content">
                        <span class="stat-value" id="totalAmount">--</span>
                        <span class="stat-label">總獎品金額</span>
                    </div>
                    <div class="stat-trend" id="amountTrend"></div>
                </div>
            </section>

            <!-- Charts Section -->
            <section class="charts-section">
                <div class="chart-container chart-large">
                    <div class="chart-header">
                        <h3 class="chart-title">📈 每日遊玩次數趨勢</h3>
                        <div class="chart-actions">
                            <button class="chart-toggle active" data-chart="line">折線圖</button>
                            <button class="chart-toggle" data-chart="bar">長條圖</button>
                        </div>
                    </div>
                    <div class="chart-body">
                        <canvas id="dailyPlaysChart"></canvas>
                    </div>
                </div>

                <div class="chart-container chart-medium">
                    <div class="chart-header">
                        <h3 class="chart-title">🔥 時段熱力分布</h3>
                    </div>
                    <div class="chart-body">
                        <canvas id="hourlyHeatmap"></canvas>
                    </div>
                    <div class="heatmap-legend">
                        <span>較少</span>
                        <div class="heatmap-gradient"></div>
                        <span>較多</span>
                    </div>
                </div>

                <div class="chart-container chart-medium">
                    <div class="chart-header">
                        <h3 class="chart-title">💎 獎品金額分布</h3>
                    </div>
                    <div class="chart-body">
                        <canvas id="amountDistChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Data Table Section -->
            <section class="table-section" id="recordsSection">
                <div class="table-header">
                    <h3 class="table-title">📝 紀錄明細</h3>
                    <div class="table-actions">
                        <div class="search-box">
                            <span class="search-icon">🔍</span>
                            <input type="text" id="searchInput" placeholder="搜尋裝置名稱...">
                        </div>
                        <button class="export-btn" id="exportCSV">
                            <span>📄</span> CSV
                        </button>
                        <button class="export-btn export-excel" id="exportExcel">
                            <span>📊</span> Excel
                        </button>
                    </div>
                </div>
                
                <!-- Device Filter -->
                <div class="device-filter" id="deviceFilter">
                    <div class="device-filter-header">
                        <span class="device-filter-title">📱 裝置篩選</span>
                        <div class="device-filter-actions">
                            <button class="device-filter-btn" id="selectAllDevices">全選</button>
                            <button class="device-filter-btn" id="deselectAllDevices">全不選</button>
                        </div>
                    </div>
                    <div class="device-list" id="deviceList">
                        <!-- Device checkboxes will be inserted here -->
                    </div>
                    <div class="device-filter-stats" id="deviceFilterStats">
                        <!-- Stats will be inserted here -->
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th class="sortable" data-sort="timestamp">
                                    時間 <span class="sort-icon">↕</span>
                                </th>
                                <th class="sortable" data-sort="amount">
                                    獎品金額 <span class="sort-icon">↕</span>
                                </th>
                                <th class="sortable" data-sort="device">
                                    裝置 <span class="sort-icon">↕</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody">
                            <!-- Data will be inserted here -->
                        </tbody>
                    </table>
                </div>
                <div class="table-footer">
                    <div class="table-info">
                        顯示 <span id="showingFrom">0</span> - <span id="showingTo">0</span> 筆，共 <span id="totalRecords">0</span> 筆
                    </div>
                    <div class="pagination" id="pagination">
                        <!-- Pagination will be inserted here -->
                    </div>
                </div>
            </section>

            <!-- Export Section (Hidden by default) -->
            <section class="export-section" id="exportSection" style="display: none;">
                <div class="export-cards">
                    <div class="export-card">
                        <div class="export-card-icon">📄</div>
                        <h3>匯出 CSV</h3>
                        <p>標準逗號分隔格式，適用於 Excel、Google Sheets 等</p>
                        <button class="export-btn-large" onclick="exportToCSV()">下載 CSV</button>
                    </div>
                    <div class="export-card">
                        <div class="export-card-icon">📊</div>
                        <h3>匯出 Excel</h3>
                        <p>Microsoft Excel 格式，包含樣式與格式設定</p>
                        <button class="export-btn-large export-excel" onclick="exportToExcel()">下載 Excel</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>載入資料中...</p>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Login Overlay -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-box">
            <div class="login-logo">🎰</div>
            <h2 class="login-title">SlotMachine Dashboard</h2>
            <p class="login-subtitle">請使用 Google 帳號登入</p>
            <div class="login-form">
                <button class="login-btn google-btn" id="googleLoginBtn">
                    <svg class="google-icon" viewBox="0 0 24 24" width="20" height="20">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    使用 Google 登入
                </button>
            </div>
            <p class="login-error" id="loginError"></p>
            <p class="login-info" id="loginInfo"></p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="app.js"></script>
</body>
</html>
